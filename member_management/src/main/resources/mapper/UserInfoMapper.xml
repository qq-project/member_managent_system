<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qiqi.member_management.management.business.mapper.UserInfoMapper">
  <resultMap id="BaseResultMap" type="com.qiqi.member_management.management.business.model.UserInfo">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="nickname" jdbcType="VARCHAR" property="nickname" />
    <result column="email" jdbcType="VARCHAR" property="email" />
    <result column="password" jdbcType="VARCHAR" property="password" />
    <result column="mobile" jdbcType="VARCHAR" property="mobile" />
    <result column="gender" jdbcType="CHAR" property="gender" />
    <result column="address" jdbcType="VARCHAR" property="address" />
    <result column="img_src" jdbcType="VARCHAR" property="imgSrc" />
    <result column="admin_flag" jdbcType="CHAR" property="adminFlag" />
    <result column="added_time" jdbcType="TIMESTAMP" property="addedTime" />
    <result column="added_by_name" jdbcType="VARCHAR" property="addedByName" />
    <result column="last_modified_time" jdbcType="TIMESTAMP" property="lastModifiedTime" />
    <result column="last_modified_by_name" jdbcType="VARCHAR" property="lastModifiedByName" />
    <result column="valid" jdbcType="CHAR" property="valid" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from t_user_info
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.qiqi.member_management.management.business.model.UserInfo">
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into t_user_info (nickname, email, password, 
      mobile, gender, address, 
      img_src, admin_flag, added_time, 
      added_by_name, last_modified_time, last_modified_by_name, 
      valid)
    values (#{nickname,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR}, 
      #{mobile,jdbcType=VARCHAR}, #{gender,jdbcType=CHAR}, #{address,jdbcType=VARCHAR}, 
      #{imgSrc,jdbcType=VARCHAR}, #{adminFlag,jdbcType=CHAR}, #{addedTime,jdbcType=TIMESTAMP}, 
      #{addedByName,jdbcType=VARCHAR}, #{lastModifiedTime,jdbcType=TIMESTAMP}, #{lastModifiedByName,jdbcType=VARCHAR}, 
      #{valid,jdbcType=CHAR})
  </insert>
  <!-- 插入前判断参数是否为空-->
  <insert id="insertSelective" parameterType="com.qiqi.member_management.management.business.model.UserInfo">
  <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
    SELECT LAST_INSERT_ID()
  </selectKey>
   insert into t_user_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
    <if test="null != nickname and '' != nickname">
      nickname,
    </if>
    <if test="null != email and '' != email">
      email,
    </if>
    <if test="null != password and '' != password">
      password,
    </if>
    <if test="null != mobile and '' != mobile">
      mobile,
    </if>
    <if test="null != gender and '' != gender">
      gender,
    </if>
    <if test="null != address and '' != address">
      address,
    </if>
    <if test="null != imgSrc and '' != imgSrc">
      img_src,
    </if>
    admin_flag,
    added_time,
    <if test="null != addedByName and '' != addedByName">
      added_by_name,
    </if>
    last_modified_time,
    <if test="null != lastModifiedByName and '' != lastModifiedByName">
        last_modified_by_name,
    </if>
    valid,
  </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="null != nickname and '' != nickname">
        #{nickname, jdbcType=VARCHAR},
      </if>
      <if test="null != email and '' != email">
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="null != password and '' != password">
        #{password,jdbcType=VARCHAR},
      </if>
      <if test="null != mobile and '' != mobile">
        #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="null != gender and '' != gender">
        #{gender,jdbcType=CHAR},
      </if>
      <if test="null != address and '' != address">
        #{address,jdbcType=VARCHAR},
      </if>
      <if test="null != imgSrc and '' != imgSrc">
        #{imgSrc,jdbcType=VARCHAR},
      </if>
      '1',
      NOW(3),
      <if test="null != addedByName and '' != addedByName">
        #{addedByName,jdbcType=VARCHAR},
      </if>
        NOW(3),
      <if test="null != lastModifiedByName and '' != lastModifiedByName">
        #{lastModifiedByName,jdbcType=VARCHAR},
      </if>
      'T',
    </trim>
  </insert>
    
  <update id="updateByPrimaryKey" parameterType="com.qiqi.member_management.management.business.model.UserInfo">
    update t_user_info
    set nickname = #{nickname,jdbcType=VARCHAR},
      email = #{email,jdbcType=VARCHAR},
      password = #{password,jdbcType=VARCHAR},
      mobile = #{mobile,jdbcType=VARCHAR},
      gender = #{gender,jdbcType=CHAR},
      address = #{address,jdbcType=VARCHAR},
      img_src = #{imgSrc,jdbcType=VARCHAR},
      admin_flag = #{adminFlag,jdbcType=CHAR},
      added_time = #{addedTime,jdbcType=TIMESTAMP},
      added_by_name = #{addedByName,jdbcType=VARCHAR},
      last_modified_time = #{lastModifiedTime,jdbcType=TIMESTAMP},
      last_modified_by_name = #{lastModifiedByName,jdbcType=VARCHAR},
      valid = #{valid,jdbcType=CHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select id, nickname, email, password, mobile, gender, address, img_src, admin_flag, 
    added_time, added_by_name, last_modified_time, last_modified_by_name, valid
    from t_user_info
    where id = #{id,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    select id, nickname, email, password, mobile, gender, address, img_src, admin_flag, 
    added_time, added_by_name, last_modified_time, last_modified_by_name, valid
    from t_user_info
  </select>
  <!--queryUserInfoByEmail-->
  <select id="queryUserInfoByEmail" parameterType="java.lang.String" resultMap="BaseResultMap">
     select
     id, nickname, email, password, mobile, gender, address, img_src, admin_flag,
     added_time, added_by_name, last_modified_time, last_modified_by_name, valid
     from  t_user_info
     where valid = 'T'
     and email = #{email,jdbcType=VARCHAR}
     order by id
     limit 1
  </select>

    <update id="updateimgSrc" parameterType="com.qiqi.member_management.management.business.model.UserInfo">
        update t_user_info set img_src = #{imgSrc,jdbcType=VARCHAR}
        where valid = 'T'
        and id = #{id, jdbcType=INTEGER}
    </update>
</mapper>